<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eclipse PDF</title>
  <meta name="description" content="Open a local PDF or pick from recent files. Eclipse PDF starts fast and respects your privacy." />
  <link rel="icon" href="./web/assets/icon.png" type="image/png" />
  <meta name="theme-color" content="#0d0f12" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; worker-src 'self' blob:; child-src blob:; connect-src 'self' https://www.eclipsepdf.com; img-src 'self' data: blob; style-src 'self' 'unsafe-inline'; font-src 'self' data: blob; object-src 'none'">

  <style>
    :root {
      --bg:#0d0f12; --surface:#111419; --surface-2:#151a21; --border:#222831;
      --fg:#e7ebf1; --muted:#a5afbd; --accent:#5cc8ff; --accent-600:#47b1e6;
      --radius:12px; --shadow-sm:0 2px 8px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial,sans-serif;
      background:var(--bg);color:var(--fg);display:grid;grid-template-rows:auto 1fr auto;min-height:100dvh;
    }

    /* header */
    header{border-bottom:1px solid var(--border);background:var(--surface)}
    .row{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
    .brand img{width:24px;height:24px;border-radius:6px}
    .brandText{line-height:1}
    .brandTop{font-size:12px;letter-spacing:.18em;text-transform:uppercase;color:rgba(231,235,241,.6)}
    .brandBottom{margin-top:-2px;font-weight:800;font-size:18px}

    /* controls */
    .btn{
      appearance:none;border:1px solid var(--border);background:var(--surface-2);
      color:inherit;border-radius:10px;cursor:pointer;font-weight:600;font-size:14px;
      padding:8px 12px;transition:background .15s ease,transform .1s ease;
    }
    .btn:hover{background:#181e26} .btn:active{transform:translateY(1px)}
    .btn-accent{background:var(--accent);color:#04131c;border:none;padding:12px 28px;font-weight:700;box-shadow:var(--shadow-sm)}
    .btn-accent:hover{background:var(--accent-600)}
    .input{width:100%;min-width:160px;max-width:320px;padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:var(--surface-2);color:var(--fg)}

    /* layout */
    main{
      max-width:1100px;margin:0 auto;padding:20px 16px 36px;display:grid;gap:16px;
      grid-template-columns:1.15fr .85fr;align-items:stretch;
    }
    @media (max-width:900px){main{grid-template-columns:1fr}}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow-sm);overflow:hidden}

    .open{padding:24px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;min-width:0;height:clamp(520px,62vh,640px);text-align:center}
    .open .logo{width:64px;height:64px;opacity:.9}
    .open h1{margin:4px 0 0;font-size:clamp(24px,5vw,32px);letter-spacing:.2px}
    .open p{margin:0;color:var(--muted)}
    .open .tiles{display:flex;gap:10px;justify-content:center;width:100%}
    .tile{flex:1;max-width:120px;border:1px solid var(--border);border-radius:10px;padding:10px;background:var(--surface-2);text-align:center}
    .tile strong{display:block;font-weight:700}
    .tile small{color:var(--muted)}
    .hidden{display:none}

    .side{display:flex;flex-direction:column;min-width:0;height:clamp(520px,62vh,640px)}
    .recents{padding:12px;display:flex;flex-direction:column;gap:12px;border-bottom:1px solid var(--border);flex:1;min-height:0}
    .rec-head{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .rec-head h2{margin:0;font-size:clamp(18px,4vw,22px)}

    .list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px;min-height:0;flex:1;overflow:auto}
    .list.empty{justify-content:center;align-items:center}
    .list.empty::before{content:"No recent files yet";color:var(--muted);font-size:14px;border:1px dashed var(--border);border-radius:10px;padding:12px 14px;display:block;max-width:260px;text-align:center}

    .item{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--surface-2);min-width:0}
    .item:hover{background:#171c23}
    .item.selected{outline:2px solid var(--accent)}
    .path{min-width:0}
    .path strong{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .meta{color:var(--muted);font-size:12px}
    .truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .itm-actions{display:flex;gap:8px}

    .tips{padding:14px 16px 18px;color:var(--muted);font-size:14px;background:var(--surface-2);border-top:1px solid var(--border)}
    .tips h3{margin:0 0 6px;font-size:clamp(18px,4vw,22px);color:var(--fg)}
    .tips kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;border:1px solid var(--border);border-bottom-width:2px;border-radius:4px;padding:2px 6px;background:var(--surface);color:var(--fg)}

    footer{border-top:1px solid var(--border);color:var(--muted);font-size:13px;background:var(--surface)}
    .foot{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  </style>
</head>
<body>
  <header>
    <div class="row">
      <a class="brand" href="#" aria-label="Eclipse PDF">
        <img src="./web/assets/icon.png" alt="Eclipse PDF logo" />
        <div class="brandText">
          <div class="brandTop">Eclipse</div>
          <div class="brandBottom">PDF</div>
        </div>
      </a>
      <!-- (Support button removed from header) -->
    </div>
  </header>

  <main>
    <section class="open card" aria-label="Open a PDF">
      <img class="logo" src="./web/assets/icon.png" alt="Eclipse PDF logo" />
      <h1>Open your PDF</h1>
      <p>Select a file to get started.</p>
      <button class="btn btn-accent" id="btnOpen">Open PDF</button>
      <input class="hidden" type="file" id="fileInput" accept="application/pdf,.pdf" />
      <div class="tiles">
        <div class="tile"><strong>Open</strong><small>Ctrl + O</small></div>
        <div class="tile"><strong>Select</strong><small>Arrow Up / Down</small></div>
        <div class="tile"><strong>Open selected</strong><small>Enter</small></div>
      </div>
    </section>

    <aside class="side card">
      <div class="recents">
        <div class="rec-head">
          <h2>Recent</h2>
          <div style="display:flex; gap:10px; align-items:center; min-width:0">
            <input class="input" id="search" placeholder="Search…" />
            <button class="btn" id="clearRecents">Clear</button>
          </div>
        </div>
        <ul class="list" id="recentList"></ul>
      </div>

      <div class="tips">
        <h3>Tips</h3>
        <div>Open: <kbd>Ctrl + O</kbd> · Select: <kbd>Up</kbd> / <kbd>Down</kbd> · Open selected: <kbd>Enter</kbd></div>
        <div style="margin-top:6px">Private & offline — your PDFs stay on your device.</div>
      </div>
    </aside>
  </main>

  <footer>
    <div class="foot">
      <div><span id="version">v0.1</span> • Local & private</div>
      <a href="#" id="openSupport" class="btn">Support</a>
    </div>
  </footer>

  <script>
    const $ = (s) => document.querySelector(s);
    const recentKey = 'eclipsepdf.recents.v1';

    function prettyName(p, fb='Document'){
      try{
        const s=decodeURIComponent(String(p||''));const base=s.split(/[\\\/]/).pop()||s;
        return base.replace(/^file:\/\/\/?/,'')||fb;
      }catch{return fb;}
    }
    function decodedPath(p){
      try{return decodeURIComponent(String(p||'')).replace(/^file:\/\/\/?/,'');}
      catch{return String(p||'');}
    }
    function toViewerPath(p){
      if(!p)return null;
      const isUrl=/^https?:\/\//i.test(p)||/^file:\/\//i.test(p);
      const formatted=isUrl?p:`file://${String(p).replace(/\\/g,'/')}`;
      return `web/viewer.html?file=${encodeURIComponent(formatted)}`;
    }

    let viewList=[];let selectedViewIdx=-1;
    function loadAll(){try{return JSON.parse(localStorage.getItem(recentKey)||'[]');}catch{return[];}}
    function saveAll(list){localStorage.setItem(recentKey,JSON.stringify(list.slice(0,50)));}
    function pushRecent(entry){
      const all=loadAll();const filtered=all.filter(x=>x.path!==entry.path);
      filtered.unshift({...entry,at:Date.now()});saveAll(filtered);renderRecents($('#search').value||'');
    }
    function deleteRecentByOriginalIndex(idx){
      const all=loadAll();all.splice(idx,1);saveAll(all);renderRecents($('#search').value||'');
    }
    function humanTime(ts){try{return new Date(ts).toLocaleString();}catch{return'';}}

    function renderRecents(filter=''){
      const ul=$('#recentList');const all=loadAll();
      const q=filter.trim().toLowerCase();
      viewList=(q?all.filter(x=>`${x.name} ${x.path}`.toLowerCase().includes(q)):all)
        .map(v=>({...v,_idx:all.indexOf(v)}));
      ul.innerHTML='';ul.classList.toggle('empty',!viewList.length);
      if(!viewList.length){selectedViewIdx=-1;return;}
      viewList.forEach((x,i)=>{
        const li=document.createElement('li');li.className='item';li.dataset.viewIndex=i;
        li.innerHTML=`<div style="min-width:0">
            <div class="path" title="${decodedPath(x.path)}"><strong>${prettyName(x.name||x.path)}</strong></div>
            <div class="meta truncate">${decodedPath(x.path)}</div>
            <div class="meta">Opened ${humanTime(x.at)}</div>
          </div>
          <div class="itm-actions">
            <button class="btn" data-open>Open</button>
            <button class="btn" data-remove>Del</button>
          </div>`;
        li.querySelector('[data-open]').addEventListener('click',()=>openTarget(x.path));
        li.querySelector('[data-remove]').addEventListener('click',()=>deleteRecentByOriginalIndex(x._idx));
        li.addEventListener('dblclick',()=>openTarget(x.path));
        li.addEventListener('click',()=>selectRow(i));
        ul.appendChild(li);
      });
      if(selectedViewIdx>=viewList.length)selectedViewIdx=viewList.length-1;
      updateSelectionUI();
    }

    function updateSelectionUI(){
      const items=[...document.querySelectorAll('#recentList .item')];
      items.forEach((li,i)=>li.classList.toggle('selected',i===selectedViewIdx));
      if(selectedViewIdx>=0&&items[selectedViewIdx])items[selectedViewIdx].scrollIntoView({block:'nearest'});
    }
    function selectRow(i){selectedViewIdx=i;updateSelectionUI();}
    function openSelected(){if(selectedViewIdx<0||selectedViewIdx>=viewList.length)return;openTarget(viewList[selectedViewIdx].path);}
    function openTarget(p){const href=toViewerPath(p);if(href)location.href=href;}

    const fileInput=$('#fileInput');
    $('#btnOpen').addEventListener('click',async()=>{
      const filePath=await window.electronAPI?.selectPDF?.();
      if(filePath){
        const name=String(filePath).split(/[\\\/]/).pop();
        pushRecent({name,path:filePath});openTarget(filePath);
      }else{
        fileInput.click();
      }
    });
    fileInput.addEventListener('change',(e)=>{
      const f=e.target.files?.[0];
      if(f){pushRecent({name:f.name,path:f.path||f.name});openTarget(f.path||f.name);}
      e.target.value='';
    });
    $('#clearRecents').addEventListener('click',()=>{localStorage.removeItem(recentKey);renderRecents();});
    $('#search').addEventListener('input',(e)=>renderRecents(e.target.value));
    window.addEventListener('keydown',(e)=>{
      if(e.ctrlKey&&e.key.toLowerCase()==='o'){e.preventDefault();$('#btnOpen').click();}
      if(e.key==='ArrowDown'){e.preventDefault();if(viewList.length){selectedViewIdx=Math.min(viewList.length-1,selectedViewIdx+1);updateSelectionUI();}}
      if(e.key==='ArrowUp'){e.preventDefault();if(viewList.length){selectedViewIdx=Math.max(0,selectedViewIdx-1);updateSelectionUI();}}
      if(e.key==='Enter'){e.preventDefault();openSelected();}
    });
    renderRecents();
    window.addEventListener('dragover',e=>e.preventDefault(),true);
    window.addEventListener('drop',e=>e.preventDefault(),true);

    /* ===== Support opens browser ===== */
    function openSupportPage(){
      if(window.electronAPI?.openExternal){
        window.electronAPI.openExternal("https://www.eclipsepdf.com/#support");
      }else{
        window.open("https://www.eclipsepdf.com/#support","_blank");
      }
    }
    $('#openSupport').addEventListener('click',e=>{e.preventDefault();openSupportPage();});

    /* ===== Show app version from Electron ===== */
    (async () => {
      try{
        const ver = await window.electronAPI?.getVersion?.();
        if (ver) document.getElementById('version').textContent = `v${ver}`;
      }catch{/* ignore */}
    })();
  </script>
</body>
</html>
